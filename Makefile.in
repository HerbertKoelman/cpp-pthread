# Top makefile to build  @PACKAGE_STRING@
#
# @configure_input@
#

prefix=@prefix@
exec_prefix=@exec_prefix@
INCLUDEDIR=@includedir@/pthread
LIBDIR=@libdir@
LOCALEDIR=@localedir@

PACKAGE_NAME=@PACKAGE_NAME@
PACKAGE_DEV=@PACKAGE_NAME@-@BUILD@-@build_os@-dev.tar.gz
PACKAGE_SRC=@PACKAGE_NAME@-@BUILD@.tar.gz

INSTALL=@INSTALL@ 
RM=@RM@
MKDIR=@MKDIR_P@
HEADERS=@HEADERS@
DOXYGEN=@DOXYGEN@
CODECHECK=@CODECHECK@
LN_S=@LN_S@
DEPLOY=@DEPLOY@
REPOSITORY=@REPOSITORY@

PTHREADLIB=libcpp-pthread.a

all: 
	cd src && $(MAKE)

pkg: clean all
	$(MKDIR) distrib
	tar cf - include lib    | gzip -c > distrib/$(PACKAGE_DEV)
	tar cf - `git ls-files` | gzip -c > distrib/$(PACKAGE_SRC)

# this target can only be used if REPOSITORY is set (hence the test)
deploy: pkg
	@test ! -z "$(REPOSITORY)" && ( cd distrib && $(DEPLOY) $(PACKAGE_DEV) $(REPOSITORY) 2> /dev/null && echo "deployed $(PACKAGE_DEV) here $(REPOSITORY)" ) || echo "WARNING use ./configure --enable-repository to enable deploy target"
	@test ! -z "$(REPOSITORY)" && ( cd distrib && $(DEPLOY) $(PACKAGE_SRC) $(REPOSITORY) 2> /dev/null && echo "deployed $(PACKAGE_SRC) here $(REPOSITORY)" ) || echo "WARNING use ./configure --enable-repository to enable deploy target"

globber:clean
	-$(RM) -R Makefile autom4te.cache config.log config.status doxyfile sonar-project.properties

clean:
	-(cd src && $(MAKE) clean)

codecheck: all
		$(CODECHECK)

version:
	touch configure.ac && ( cd src && touch configure.ac )
	autoconf && ( cd src && autoconf )
	-echo "don't forget to run configure."

doxygen:
	${DOXYGEN} doxyfile

install:
	-(cd src && $(MAKE) install)

uninstall:
	-(cd src && $(MAKE) uninstall)
