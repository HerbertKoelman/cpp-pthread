#
# builds substation related programs

# Compile c++ source code
.SUFFIXES:.cpp

BASEDIR=../
XREFDIR=${BASEDIR}/xref/
UDATAOBJ=$(BASEDIR)/udataobj/
BINDIR=$(BASEDIR)/bin/
APPDIR=$(BASEDIR)/app/
INCDIR=$(BASEDIR)/include/
LIBDIR=$(BASEDIR)/lib/
LOCALEDIR=${BASEDIR}/locale

CC=@CC@
CCC=@CXX@
CXX=$CCC
RANLIB=@RANLIB@
RM=rm -f
AR=@AR@ @ARFLAGS@
MV=@MV@
LN_S=@LN_S@

BITS=@BITS@
OBJECT_MODE=$(BITS)
LIBS=@LIBS@

CXXFLAGS=@CXXFLAGS@
CFLAGS=@CFLAGS@
CPPFLAGS=@CPPFLAGS@

LDFLAGS=@LDFLAGS@
LIBS=@LIBS@

OBJECTS=@OBJECTS@

TARGETS=lib@PACKAGE_NAME@-@BUILD@.a

all:${TARGETS}

lib@PACKAGE_NAME@-@BUILD@.a: $(OBJECTS)
	${AR} ${LIBDIR}/$@ $(OBJECTS)
	$(RANLIB) ${LIBDIR}/$@
	cd ${LIBDIR} && $(LN_S) -f lib@PACKAGE_NAME@-@BUILD@.a lib@PACKAGE_NAME@.a

globber: clean
	-$(RM) -R Makefile autom4te.cache config.log config.status 

clean:
	${RM} *.o core *.a
	cd $(LIBDIR) && ${RM} lib@PACKAGE_NAME@* 

cxref:
	cxref *.c -xref -index-all -latex209 -O${XREFDIR} -I${INCDIR} -I${INCTUX}

# cpp build rule
.cpp.o:
	$(CCC) $(CPPFLAGS) $(CXXFLAGS) $(CFLAGS) -c $<

.cpp:
	$(CCC) $(CPPFLAGS) $(CXXFLAGS) $(CFLAGS) $< -o $@ $(LDFLAGS) $(LIBS)
